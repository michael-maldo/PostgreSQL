"use strict";(globalThis.webpackChunkpostgresql=globalThis.webpackChunkpostgresql||[]).push([[415],{1135:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"Web/intro","title":"Intro","description":"Introduction to WEB","source":"@site/docs/Web/intro.mdx","sourceDirName":"Web","slug":"/Web/intro","permalink":"/docs/Web/intro","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"docker","permalink":"/docs/tags/docker"},{"inline":true,"label":"stop / start","permalink":"/docs/tags/stop-start"}],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Intro","description":"Introduction to WEB","tags":["docker","stop / start"]},"sidebar":"tutorialSidebar","previous":{"title":"Web","permalink":"/docs/category/web"},"next":{"title":"ssh-key","permalink":"/docs/category/ssh-key"}}');var s=r(4848),i=r(8453);const t={sidebar_position:1,title:"Intro",description:"Introduction to WEB",tags:["docker","stop / start"]},l="Spring Boot REST API -in Docker",c={},d=[{value:"1\ufe0f\u20e3 Generate an SSL certificate",id:"1\ufe0f\u20e3-generate-an-ssl-certificate",level:2},{value:"2\ufe0f\u20e3 Configure Spring Boot for HTTPS",id:"2\ufe0f\u20e3-configure-spring-boot-for-https",level:2},{value:"3\ufe0f\u20e3 Add keystore to Docker image",id:"3\ufe0f\u20e3-add-keystore-to-docker-image",level:2},{value:"Option 1: Copy into image",id:"option-1-copy-into-image",level:3},{value:"Option 2: Mount as volume (recommended for production)",id:"option-2-mount-as-volume-recommended-for-production",level:3},{value:"4\ufe0f\u20e3 Test HTTPS locally",id:"4\ufe0f\u20e3-test-https-locally",level:2},{value:"\u2705 TL;DR Workflow",id:"-tldr-workflow",level:3},{value:"5\ufe0f\u20e3 Optional: use a reverse proxy (production best practice)",id:"5\ufe0f\u20e3-optional-use-a-reverse-proxy-production-best-practice",level:2},{value:"Expose HTTPS port (8443) in Dockerfile and docker run",id:"expose-https-port-8443-in-dockerfile-and-docker-run",level:3},{value:"Reverse Proxy + SSL",id:"reverse-proxy--ssl",level:3},{value:"Example: Nginx Setup on VPS",id:"example-nginx-setup-on-vps",level:3},{value:"Docker Setup",id:"docker-setup",level:3},{value:"Optional: Dockerized Nginx",id:"optional-dockerized-nginx",level:3},{value:"Advantages of Reverse Proxy Approach",id:"advantages-of-reverse-proxy-approach",level:3},{value:"\u2705 TL;DR",id:"-tldr",level:3}];function a(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsxs)(n.h1,{id:"spring-boot-rest-api--in-docker",children:["Spring Boot REST API ",(0,s.jsx)("br",{}),"-in Docker"]})}),"\n",(0,s.jsxs)(n.p,{children:["serve HTTPS instead of plain HTTP",(0,s.jsx)("br",{}),"\nLocal testing and VPS deployment."]}),"\n",(0,s.jsx)(n.h2,{id:"1\ufe0f\u20e3-generate-an-ssl-certificate",children:"1\ufe0f\u20e3 Generate an SSL certificate"}),"\n",(0,s.jsx)(n.p,{children:"You have a few options:"}),"\n",(0,s.jsxs)(n.p,{children:["A. Self-signed (for testing)\nkeytool -genkeypair ",(0,s.jsx)(n.br,{}),"\n","-alias gnostex ",(0,s.jsx)(n.br,{}),"\n","-keyalg RSA ",(0,s.jsx)(n.br,{}),"\n","-keysize 2048 ",(0,s.jsx)(n.br,{}),"\n","-storetype PKCS12 ",(0,s.jsx)(n.br,{}),"\n","-keystore gnostex.p12 ",(0,s.jsx)(n.br,{}),"\n","-validity 3650 ",(0,s.jsx)(n.br,{}),"\n",'-dname "CN=yourdomain.com, OU=Dev, O=YourCompany, L=City, S=State, C=US" ',(0,s.jsx)(n.br,{}),"\n","-storepass changeit ",(0,s.jsx)(n.br,{}),"\n","-keypass changeit"]}),"\n",(0,s.jsx)(n.p,{children:"Generates a PKCS12 keystore (gnostex.p12) containing private key + certificate."}),"\n",(0,s.jsx)(n.p,{children:"Remember the password \u2014 you\u2019ll need it in Spring Boot."}),"\n",(0,s.jsx)(n.p,{children:"B. Production (recommended)"}),"\n",(0,s.jsx)(n.p,{children:"Use Let\u2019s Encrypt with Certbot to generate a real SSL certificate."}),"\n",(0,s.jsx)(n.p,{children:"Mount the certificate in your container (or use a reverse proxy like Nginx/Traefik)."}),"\n",(0,s.jsx)(n.h2,{id:"2\ufe0f\u20e3-configure-spring-boot-for-https",children:"2\ufe0f\u20e3 Configure Spring Boot for HTTPS"}),"\n",(0,s.jsx)(n.p,{children:"Add these properties to application-dev.properties (or application-prod.properties for production):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"server.port=8443\nserver.ssl.enabled=true\nserver.ssl.key-store=classpath:gnostex.p12\nserver.ssl.key-store-password=changeit\nserver.ssl.key-store-type=PKCS12\nserver.ssl.key-alias=gnostex\n"})}),"\n",(0,s.jsx)(n.p,{children:"server.port=8443 \u2192 HTTPS default port"}),"\n",(0,s.jsx)(n.p,{children:"server.ssl.key-store \u2192 path to your .p12 keystore"}),"\n",(0,s.jsx)(n.p,{children:"server.ssl.key-store-password \u2192 the password you used"}),"\n",(0,s.jsx)(n.p,{children:"server.ssl.key-alias \u2192 alias of the key in the keystore"}),"\n",(0,s.jsx)(n.p,{children:"If your keystore is outside the JAR (like in Docker), you can use file:/app/certs/gnostex.p12 instead of classpath:."}),"\n",(0,s.jsx)(n.h2,{id:"3\ufe0f\u20e3-add-keystore-to-docker-image",children:"3\ufe0f\u20e3 Add keystore to Docker image"}),"\n",(0,s.jsx)(n.h3,{id:"option-1-copy-into-image",children:"Option 1: Copy into image"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"//copy SSL certificate into container\nCOPY certs/gnostex.p12 /app/certs/gnostex.p12\n"})}),"\n",(0,s.jsx)(n.h3,{id:"option-2-mount-as-volume-recommended-for-production",children:"Option 2: Mount as volume (recommended for production)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"docker run -d \\\n-p 8443:8443 \\\n-v /home/deploy/certs:/app/certs \\\n-e SPRING_PROFILES_ACTIVE=prod \\\n-e DB_URL=jdbc:postgresql://host.docker.internal:5432/gnostexdb \\\n-e DB_USERNAME=gnostex \\\n-e DB_PASSWORD=gnostex \\\nghcr.io/michael-maldo/gnostex-backend-api:latest\n"})}),"\n",(0,s.jsx)(n.h2,{id:"4\ufe0f\u20e3-test-https-locally",children:"4\ufe0f\u20e3 Test HTTPS locally"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"curl -k https://localhost:8443/actuator/health\n"})}),"\n",(0,s.jsx)(n.p,{children:"-k skips verification if self-signed."}),"\n",(0,s.jsx)(n.p,{children:"If using Let\u2019s Encrypt, -k is not needed."}),"\n",(0,s.jsx)(n.h3,{id:"-tldr-workflow",children:"\u2705 TL;DR Workflow"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Generate SSL certificate (self-signed or Let\u2019s Encrypt)"}),"\n",(0,s.jsx)(n.li,{children:"Configure Spring Boot server.ssl.* properties"}),"\n",(0,s.jsx)(n.li,{children:"Copy or mount keystore into container"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"5\ufe0f\u20e3-optional-use-a-reverse-proxy-production-best-practice",children:"5\ufe0f\u20e3 Optional: use a reverse proxy (production best practice)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Instead of letting Spring Boot handle SSL:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Run Spring Boot with HTTP only (server.port=8080)."}),"\n",(0,s.jsx)(n.li,{children:"Put Nginx/Traefik/HAProxy in front."}),"\n",(0,s.jsx)(n.li,{children:"Let the proxy handle SSL termination with real certificates."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Advantages:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No need to rebuild Docker image for SSL changes"}),"\n",(0,s.jsx)(n.li,{children:"Easier certificate renewal (e.g., Certbot)"}),"\n",(0,s.jsx)(n.li,{children:"Supports multiple apps/domains on same VPS"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"expose-https-port-8443-in-dockerfile-and-docker-run",children:"Expose HTTPS port (8443) in Dockerfile and docker run"}),"\n",(0,s.jsx)(n.p,{children:"https:// endpoint"}),"\n",(0,s.jsx)(n.h3,{id:"reverse-proxy--ssl",children:"Reverse Proxy + SSL"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Spring Boot app stays HTTP only on port 8080 inside Docker."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"A reverse proxy (Nginx/Traefik/HAProxy)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"sits in front"}),"\n",(0,s.jsx)(n.li,{children:"listens on HTTPS port 443"}),"\n",(0,s.jsx)(n.li,{children:"Terminates SSL (handles HTTPS handshake)"}),"\n",(0,s.jsx)(n.li,{children:"Forwards requests to your Spring Boot app over HTTP (8080)"}),"\n",(0,s.jsx)(n.li,{children:"Can handle multiple apps/domains on the same VPS"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This way:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You don\u2019t need Spring Boot to know anything about certificates."}),"\n",(0,s.jsx)(n.li,{children:"Certificates are easy to renew (Let\u2019s Encrypt)."}),"\n",(0,s.jsx)(n.li,{children:"CI/CD workflow stays simpler."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example-nginx-setup-on-vps",children:"Example: Nginx Setup on VPS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Install Nginx:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo dnf install nginx -y   # Fedora / CentOS\nsudo systemctl enable nginx\nsudo systemctl start nginx\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Obtain a certificate (Let\u2019s Encrypt):"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo dnf install certbot python3-certbot-nginx -y\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Certbot will automatically configure Nginx for HTTPS."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Nginx reverse proxy config (simplified example):"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"server {\nlisten 80;\nserver_name yourdomain.com www.yourdomain.com;\n\n    # Redirect HTTP to HTTPS\n    return 301 https://$host$request_uri;\n}\n\nserver {\nlisten 443 ssl;\nserver_name yourdomain.com www.yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Requests come to HTTPS 443 \u2192 Nginx \u2192 forwards to Spring Boot 8080"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"docker-setup",children:"Docker Setup"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Spring Boot Docker container stays HTTP:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"docker run -d \\\n--name gnostex-backend-api \\\n--restart unless-stopped \\\n-p 8080:8080 \\\n-e SPRING_PROFILES_ACTIVE=prod \\\n-e DB_URL=jdbc:postgresql://host.docker.internal:5432/gnostexdb \\\n-e DB_USERNAME=gnostex \\\n-e DB_PASSWORD=gnostex \\\nghcr.io/michael-maldo/gnostex-backend-api:latest\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Nginx listens on 80/443 and proxies to the container."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"optional-dockerized-nginx",children:"Optional: Dockerized Nginx"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Instead of installing Nginx on VPS host, you can run Nginx in a Docker container:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'version: "3"\n\nservices:\ngnostex-backend-api:\nimage: ghcr.io/michael-maldo/gnostex-backend-api:latest\ncontainer_name: gnostex-backend-api\nrestart: unless-stopped\nenvironment:\nSPRING_PROFILES_ACTIVE: prod\nDB_URL: jdbc:postgresql://host.docker.internal:5432/gnostexdb\nDB_USERNAME: gnostex\nDB_PASSWORD: gnostex\nports:\n- "8080:8080"\n\nnginx:\nimage: nginx:latest\ncontainer_name: nginx-proxy\nrestart: unless-stopped\nvolumes:\n- ./nginx.conf:/etc/nginx/conf.d/default.conf:ro\n- /etc/letsencrypt:/etc/letsencrypt:ro\nports:\n- "80:80"\n- "443:443"\n'})}),"\n",(0,s.jsx)(n.p,{children:"This way your whole stack is containerized."}),"\n",(0,s.jsx)(n.h3,{id:"advantages-of-reverse-proxy-approach",children:"Advantages of Reverse Proxy Approach"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Benefit\tExplanation","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Easier SSL\tLet\u2019s Encrypt handles it automatically"}),"\n",(0,s.jsx)(n.li,{children:"Multiple apps\tOne Nginx can route many containers/domains"}),"\n",(0,s.jsx)(n.li,{children:"Simpler Spring Boot\tApp doesn\u2019t need SSL certificates"}),"\n",(0,s.jsx)(n.li,{children:"Cert renewal\tAutomated via cron or Certbot"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-tldr",children:"\u2705 TL;DR"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Spring Boot \u2192 HTTP only (port 8080)"}),"\n",(0,s.jsx)(n.li,{children:"Nginx/Traefik \u2192 listens HTTPS (443)"}),"\n",(0,s.jsx)(n.li,{children:"Nginx proxies traffic to Spring Boot (HTTP 8080)"}),"\n",(0,s.jsx)(n.li,{children:"Use Let\u2019s Encrypt for free SSL"}),"\n",(0,s.jsx)(n.li,{children:"Your Dockerfile stays mostly unchanged"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var o=r(6540);const s={},i=o.createContext(s);function t(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);